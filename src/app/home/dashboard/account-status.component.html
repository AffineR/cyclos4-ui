<page-content *ngFor="let history of histories$ | async" [heading]="title(history)"
  [headingActions]="headingActions(history)" hideBack>
  <div class="row mb-3">
    <div class="col-6 balance-label" i18n>Balance</div>
    <div class="col-6 balance-value" [ngClass]="{
      negative: format.isNegative(history.account.status.balance),
      positive: format.isPositive(history.account.status.balance)
    }">
      {{ history.account.status.balance | currency:history.account.currency
      }}
    </div>
  </div>
  <canvas balanceHistoryChart [history]="history" width="400" height="140"></canvas>
  <h3 class="border-0 mt-3 mb-2 text-body" i18n>Last incoming payments</h3>
  <ng-container *ngIf="(lastPayments[history.account.id] | async) != null; else loadingTransfers">
    <table class="table table-hover mb-0 cursor-pointer" *ngIf="(lastPayments[history.account.id] | async).length > 0; else noTransfers">
      <tr *ngFor="let transfer of lastPayments[history.account.id].value; let last = last"
        (click)="router.navigate(transferPath(transfer))">
        <td style="width:20%" class="text-left p-1 pl-0 text-muted" [ngClass]="{'border-0': last}">
          {{ transfer.date | date }}
        </td>
        <td style="width:45%" class="text-center p-1 text-muted" [ngClass]="{'border-0': last}">
          {{ subjectName(transfer) }}
        </td>
        <td style="width:35%" class="text-right p-1" [ngClass]="{
          negative: format.isNegative(transfer.amount),
          positive: format.isPositive(transfer.amount),
          'border-0': last
        }">
          {{ transfer.amount | currency: history.account.currency }}
        </td>
      </tr>
    </table>
    <ng-template #noTransfers>
      <ng-container i18n>No incoming payments</ng-container>
    </ng-template>
  </ng-container>
  <ng-template #loadingTransfers>
    <spinner></spinner>
  </ng-template>
</page-content>
