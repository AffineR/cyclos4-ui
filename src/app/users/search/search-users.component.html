<page-layout [tightContent]="true"
  [title]="messages.userSearchTitle()"
  [hasHeader]="true"
  [loaded]="loaded"
  [filtersForm]="form">
  <page-header>
    <div style="opacity: 0.6"
      fxLayout="row-reverse">
      <mat-icon ngClass="mat-22">save</mat-icon>
      <mat-icon ngClass="mat-22"
        style="margin-right: 10px">print</mat-icon>
    </div>
  </page-header>
  <page-filters>
    <form *ngIf="query != null"
      fxLayout="column"
      [formGroup]="form">
      <mat-form-field>
        <input formControlName="keywords"
          matInput
          [placeholder]="messages.keywords()">
      </mat-form-field>
    </form>
  </page-filters>
  <page-content>
    <table *ngIf="!(dataSource.empty | async)"
      mat-table
      #table
      [dataSource]="dataSource">
      <!-- Avatar column -->
      <ng-container matColumnDef="avatar">
        <th mat-header-cell
          *matHeaderCellDef
          class="avatar"></th>
        <td mat-cell
          *matCellDef="let row"
          class="avatar">
          <avatar [image]="row.image"></avatar>
        </td>
      </ng-container>

      <!-- Aggregated (for small devices) -->
      <ng-container matColumnDef="aggregated">
        <th mat-header-cell
          *matHeaderCellDef></th>
        <td mat-cell
          *matCellDef="let row">
          <a [routerLink]="path(row)">
            <div *ngIf="fieldsInList.length == 0"
              class="cell-text cell-main">{{ row.display }}</div>
            <ng-container *ngFor="let field of fieldsInList; let first = first">
              <div [ngClass]="{
                  'cell-text': true,
                  'cell-main': first
                }">
                <format-field-value [fields]="data.customFields"
                  [fieldName]="field"
                  [object]="row"></format-field-value>
              </div>
            </ng-container>
          </a>
        </td>
      </ng-container>

      <!-- Display column -->
      <ng-container matColumnDef="display">
        <th mat-header-cell
          *matHeaderCellDef>{{ messages.user() }}</th>
        <td mat-cell
          *matCellDef="let row">
          <a [routerLink]="path(row)">
            {{ row.display }}
          </a>
        </td>
      </ng-container>

      <!-- As material table don't work with dynamic column definitions, we have to hardcode with up to a fixed number of columns -->
      <ng-container matColumnDef="field0">
        <th mat-header-cell
          *matHeaderCellDef>{{ fieldName(0) }}</th>
        <td mat-cell
          *matCellDef="let row">
          <a [routerLink]="path(row)">
            <format-field-value [fields]="data.customFields"
              [fieldName]="fieldInternalName(0)"
              [object]="row"></format-field-value>
          </a>
        </td>
      </ng-container>

      <ng-container matColumnDef="field1">
        <th mat-header-cell
          *matHeaderCellDef>{{ fieldName(1) }}</th>
        <td mat-cell
          *matCellDef="let row">
          <a [routerLink]="path(row)">
            <format-field-value [fields]="data.customFields"
              [fieldName]="fieldInternalName(1)"
              [object]="row"></format-field-value>
          </a>
        </td>
      </ng-container>

      <ng-container matColumnDef="field2">
        <th mat-header-cell
          *matHeaderCellDef>{{ fieldName(2) }}</th>
        <td mat-cell
          *matCellDef="let row">
          <a [routerLink]="path(row)">
            <format-field-value [fields]="data.customFields"
              [fieldName]="fieldInternalName(2)"
              [object]="row"></format-field-value>
          </a>
        </td>
      </ng-container>

      <ng-container matColumnDef="field3">
        <th mat-header-cell
          *matHeaderCellDef>{{ fieldName(3) }}</th>
        <td mat-cell
          *matCellDef="let row">
          <a [routerLink]="path(row)">
            <format-field-value [fields]="data.customFields"
              [fieldName]="fieldInternalName(3)"
              [object]="row"></format-field-value>
          </a>
        </td>
      </ng-container>

      <ng-container matColumnDef="field4">
        <th mat-header-cell
          *matHeaderCellDef>{{ fieldName(4) }}</th>
        <td mat-cell
          *matCellDef="let row">
          <a [routerLink]="path(row)">
            <format-field-value [fields]="data.customFields"
              [fieldName]="fieldInternalName(4)"
              [object]="row"></format-field-value>
          </a>
        </td>
      </ng-container>

      <ng-container matColumnDef="field5">
        <th mat-header-cell
          *matHeaderCellDef>{{ fieldName(5) }}</th>
        <td mat-cell
          *matCellDef="let row">
          <a [routerLink]="path(row)">
            <format-field-value [fields]="data.customFields"
              [fieldName]="fieldInternalName(5)"
              [object]="row"></format-field-value>
          </a>
        </td>
      </ng-container>

      <ng-container matColumnDef="field6">
        <th mat-header-cell
          *matHeaderCellDef>{{ fieldName(6) }}</th>
        <td mat-cell
          *matCellDef="let row">
          <a [routerLink]="path(row)">
            <format-field-value [fields]="data.customFields"
              [fieldName]="fieldInternalName(6)"
              [object]="row"></format-field-value>
          </a>
        </td>
      </ng-container>

      <ng-container *ngIf="(displayedColumns | async).length > 2">
        <tr mat-header-row
          *matHeaderRowDef="displayedColumns | async"></tr>
      </ng-container>
      <tr mat-row
        *matRowDef="let row; columns: displayedColumns | async;"
        ngClass.xs="dynamic"
        ngClass="clickable"
        (click)="router.navigate(path(row))"></tr>
    </table>
    <paginator (update)="update()"
      [query]="query"
      [dataSource]="dataSource"></paginator>
  </page-content>
</page-layout>
