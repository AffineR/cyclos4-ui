<page-layout [menu]="menu" [tightContent]="true"
  [loaded]="loaded" [hasFilters]="true"
  [hasHeader]="(status | async).length > 1">
  <page-header [title]="title">
    <div class="indicators">
      <ng-container *ngFor="let indicator of (status | async); let last = last">
        <div class="indicator">
          <div class="label">{{ indicator.label }}</div>
          <div class="amount">{{ indicator.amount | currency:currency }}</div>
        </div>
        <div *ngIf="!last" class="indicator-separator"></div>
      </ng-container>
    </div>    
  </page-header>
  <page-filters>
    <form #filtersForm="ngForm" *ngIf="query != null" fxLayout="column">
      <mat-form-field *ngIf="transferFilters.length > 1">
        <mat-select fxFlex="grow"
          [placeholder]="bankingMessages.accountTransferFilter()"
          [(ngModel)]="transferFilterId" name="transferFilter">
          <mat-option [value]="">{{ generalMessages.searchAll() }}</mat-option>
          <mat-option *ngFor="let filter of transferFilters"
            [value]="filter.id">{{ filter.name }}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field *ngIf="preselectedPeriods.length > 1">
        <mat-select
          fxFlex="grow"
          [placeholder]="generalMessages.period()"
          [(ngModel)]="preselectedPeriod" name="preselectedPeriod">
          <mat-option *ngFor="let period of preselectedPeriods"
            [value]="period">{{ period.name }}</mat-option>
        </mat-select>
      </mat-form-field>
      <date-field *ngIf="preselectedPeriod?.begin == null"
        fxFlex="grow"
        [(ngModel)]="query.datePeriod[0]" name="periodBegin"
        [placeholder]="generalMessages.periodBegin()"></date-field>
      <date-field *ngIf="preselectedPeriod?.end == null"
        fxFlex="grow"
        [(ngModel)]="query.datePeriod[1]" name="periodEnd"
        [placeholder]="generalMessages.periodEnd()"></date-field>
    </form>
  </page-filters>
  <page-content [title]="(status | async).length > 1 ? null : title">
    <mat-table #table [fxHide]="(dataSource.empty | async)" [dataSource]="dataSource">
      <!-- Avatar column -->
      <ng-container matColumnDef="avatar">
        <mat-header-cell *matHeaderCellDef class="avatar"></mat-header-cell>
        <mat-cell *matCellDef="let row" class="avatar">
          <avatar [image]="row.relatedAccount.kind == 'user' ? row.relatedAccount.user.image : null"
            [icon]="row.relatedAccount.kind == 'user' ? 'account_circle' : 'account_balance'"></avatar>
        </mat-cell>
      </ng-container>

      <!-- Aggregated (for small devices) -->
      <ng-container matColumnDef="aggregated">
        <mat-header-cell *matHeaderCellDef></mat-header-cell>
        <mat-cell *matCellDef="let row">
          <div class="cell-main">{{ subjectName(row) }}</div>
          <div class="cell-date">{{ row.date | dateTime }}</div>
          <div *ngIf="row.description" class="cell-small">{{ row.description }}</div>
        </mat-cell>
      </ng-container>

      <!-- Date column -->
      <ng-container matColumnDef="date">
        <mat-header-cell *matHeaderCellDef>{{ bankingMessages.transactionDate() }}</mat-header-cell>
        <mat-cell *matCellDef="let row">{{ row.date | date }}</mat-cell>
      </ng-container>

      <!-- Subject column -->
      <ng-container matColumnDef="subject">
        <mat-header-cell *matHeaderCellDef>{{ bankingMessages.transactionSubject() }}</mat-header-cell>
        <mat-cell *matCellDef="let row">{{ subjectName(row) }}</mat-cell>
      </ng-container>

      <!-- Amount column -->
      <ng-container matColumnDef="amount">
        <mat-header-cell *matHeaderCellDef style="text-align: end">{{ bankingMessages.transactionAmount() }}</mat-header-cell>
        <mat-cell *matCellDef="let row" style="text-align: end">{{ row.amount | currency:currency }}</mat-cell>
      </ng-container>
      
      <mat-header-row *matHeaderRowDef="layout.xs ? [] : displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;" class.xs="dynamic"></mat-row>
    </mat-table>
    <paginator (update)="update()" [query]="query" [dataSource]="dataSource"></paginator>
  </page-content>
</page-layout>